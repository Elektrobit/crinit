<!DOCTYPE html>

<html lang="en" data-content_root="../../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />
    <link href="../../_static/favicon_16x16.png" sizes="16x16" rel="icon" type="image/png">
    <link href="../../_static/favicon_32x32.png" sizes="32x32" rel="icon" type="image/png">
    <title>Architecture Design Record - INCLUDE file options &#8212; crinit  documentation</title>
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=4f649999" />
    <link rel="stylesheet" type="text/css" href="../../_static/alabaster.css?v=039e1c02" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css?v=76b2166b" />
    <script src="../../_static/documentation_options.js?v=5929fcd5"></script>
    <script src="../../_static/doctools.js?v=888ff710"></script>
    <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../../_static/copybutton.js?v=f281be69"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="prev" title="Architecture Design Record - Storage scheme for file signatures" href="adr-signature-storage.html" />
   
  <link rel="stylesheet" href="../../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="architecture-design-record-include-file-options">
<h1>Architecture Design Record - INCLUDE file options<a class="headerlink" href="#architecture-design-record-include-file-options" title="Link to this heading">¶</a></h1>
<section id="problem">
<h2>Problem<a class="headerlink" href="#problem" title="Link to this heading">¶</a></h2>
<p>Crinit needs support for include files in task configuration to provide templates to third-party developers. The main
requirement is to define base sets of dependencies but pre-defining other settings may be possible.</p>
<p>An example might look similar to this:</p>
<p><strong>Include file</strong> (<code class="docutils literal notranslate"><span class="pre">server.crincl</span></code>)</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">DEPENDS</span> <span class="o">=</span> <span class="nd">@provided</span><span class="p">:</span><span class="n">network</span> <span class="n">sql</span><span class="o">-</span><span class="n">db</span><span class="p">:</span><span class="n">spawn</span> <span class="n">other</span><span class="o">-</span><span class="n">base</span><span class="o">-</span><span class="n">dependency</span><span class="p">:</span><span class="n">wait</span>
<span class="n">RESPAWN</span> <span class="o">=</span> <span class="n">YES</span>

<span class="n">ENV_SET</span> <span class="o">=</span> <span class="n">BASE_ENV_VARIABLE</span> <span class="s2">&quot;foo&quot;</span>
</pre></div>
</div>
<p><strong>Task configuration</strong> (<code class="docutils literal notranslate"><span class="pre">httpd.crinit</span></code>)</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">NAME</span> <span class="o">=</span> <span class="n">httpd</span>
<span class="n">INCLUDE</span> <span class="o">=</span> <span class="n">server</span><span class="o">.</span><span class="n">crincl</span>

<span class="n">COMMAND</span><span class="p">[]</span> <span class="o">=</span> <span class="o">/</span><span class="n">path</span><span class="o">/</span><span class="n">to</span><span class="o">/</span><span class="n">httpd</span> <span class="o">--</span><span class="n">some</span><span class="o">-</span><span class="n">options</span>

<span class="n">RESPAWN</span> <span class="o">=</span> <span class="n">NO</span>
<span class="n">DEPENDS</span> <span class="o">=</span> <span class="n">added</span><span class="o">-</span><span class="n">dep</span><span class="p">:</span><span class="n">wait</span>
<span class="n">ENV_SET</span> <span class="o">=</span> <span class="n">ADDED_ENV_VARIABLE</span> <span class="s2">&quot;bar&quot;</span>
<span class="n">ENV_SET</span> <span class="o">=</span> <span class="n">COMPOUND_VAR</span> <span class="s2">&quot;$</span><span class="si">{BASE_ENV_VARIABLE}</span><span class="s2"> $</span><span class="si">{ADDED_ENV_VARIABLE}</span><span class="s2"> baz&quot;</span>
</pre></div>
</div>
<p>This leads to the question of which options to allow in an include file and what the append/override policy is for them.
The example suggests to merge/append some variables (<code class="docutils literal notranslate"><span class="pre">DEPENDS</span></code>, <code class="docutils literal notranslate"><span class="pre">ENV_SET</span></code>) but override others (<code class="docutils literal notranslate"><span class="pre">RESPAWN</span></code>) but this may
not be the best solution in all cases.</p>
</section>
<section id="influencing-factors">
<h2>Influencing Factors<a class="headerlink" href="#influencing-factors" title="Link to this heading">¶</a></h2>
<ul class="simple">
<li><p>ease of use / intuitively usable</p></li>
<li><p>the design shall not allow circumvention of security</p></li>
</ul>
</section>
<section id="considered-alternatives">
<h2>Considered Alternatives<a class="headerlink" href="#considered-alternatives" title="Link to this heading">¶</a></h2>
<section id="option-1-all-options-possible-pre-set-policy">
<h3>Option 1 - All options possible, pre-set policy<a class="headerlink" href="#option-1-all-options-possible-pre-set-policy" title="Link to this heading">¶</a></h3>
<p>We have a pre-set append/override policy, like “Options get appended to where possible. If the option is single value,
it will be overriden.” If multiple include files are given, append and override happens in the order they are INCLUDEd.
All options valid in task configurations are also valid in <code class="docutils literal notranslate"><span class="pre">INCLUDE</span></code> files.</p>
<section id="pros">
<h4>Pros<a class="headerlink" href="#pros" title="Link to this heading">¶</a></h4>
<ul class="simple">
<li><p>simple concept</p></li>
<li><p>least implementation effort</p></li>
<li><p>low documentation effort</p></li>
</ul>
</section>
<section id="cons">
<h4>Cons<a class="headerlink" href="#cons" title="Link to this heading">¶</a></h4>
<ul class="simple">
<li><p>limited functionality</p></li>
<li><p>overriding of multi-value options impossible</p>
<ul>
<li><p>prohibits advanced usage</p></li>
<li><p>may lead to need for multiple include files to choose from on downstream side</p></li>
</ul>
</li>
<li><p>can become chaotic especially if more than one include file is involved.</p></li>
<li><p>some options can be problematic in an include file</p>
<ul>
<li><p>Example: <code class="docutils literal notranslate"><span class="pre">COMMAND[]</span></code> can be appended to. If include files are used to prepend commands to downstream task files,
the configuration effort becomes high and behavior may seem opaque to the downstream user.</p></li>
</ul>
</li>
</ul>
</section>
</section>
<section id="option-2-all-options-possible-with-task-configurable-subset">
<h3>Option 2 - All options possible with task-configurable subset<a class="headerlink" href="#option-2-all-options-possible-with-task-configurable-subset" title="Link to this heading">¶</a></h3>
<p>Like option 1 but we allow tasks to optionally define a list of option imports from the INCLUDE file. This could look
like the following:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">INCLUDE</span> <span class="o">=</span> <span class="n">some</span><span class="o">-</span><span class="n">include</span><span class="o">.</span><span class="n">crincl</span> <span class="n">DEPENDS</span><span class="p">,</span><span class="n">RESPAWN</span>
</pre></div>
</div>
<p>In this case only  the <code class="docutils literal notranslate"><span class="pre">DEPENDS</span></code> and <code class="docutils literal notranslate"><span class="pre">RESPAWN</span></code> options are imported from the include file. Append/override afterwards
works as in option 1. If no import list is given, it will work the same as option 1 by default.</p>
<section id="id1">
<h4>Pros<a class="headerlink" href="#id1" title="Link to this heading">¶</a></h4>
<ul class="simple">
<li><p>simple extension of Option 1</p></li>
<li><p>big improvement in usability</p></li>
<li><p>users can rely on pre-sets but also have full control over what they import</p></li>
<li><p>greatest flexibility from downstream perspective</p></li>
</ul>
</section>
<section id="id2">
<h4>Cons<a class="headerlink" href="#id2" title="Link to this heading">¶</a></h4>
<ul class="simple">
<li><p>effective usage of imports requires more system knowledge than plain option 1</p></li>
<li><p>changes (esp. additions) in include files may not propagate downstream if a task does not import the new option</p></li>
<li><p>some options can be problematic in an include file (see above)</p></li>
</ul>
</section>
</section>
<section id="option-3-limited-number-of-options-possible-with-task-configurable-subset">
<h3>Option 3 - Limited number of options possible with task-configurable subset<a class="headerlink" href="#option-3-limited-number-of-options-possible-with-task-configurable-subset" title="Link to this heading">¶</a></h3>
<p>Like option 2 but not all options are allowed in an include file. We shall maintain a documented list of all options,
indicating if they are include-safe and what their append/override policy is.</p>
<section id="id3">
<h4>Pros<a class="headerlink" href="#id3" title="Link to this heading">¶</a></h4>
<ul class="simple">
<li><p>improves on option 2 by filtering out options, thereby limiting configuration complexity</p>
<ul>
<li><p>encourages intended usage</p></li>
</ul>
</li>
<li><p>maintaining this table in documentation is a good idea anyway as configuration options become more numerous/complex</p></li>
<li><p>otherwise same as option 2</p></li>
</ul>
</section>
<section id="id4">
<h4>Cons<a class="headerlink" href="#id4" title="Link to this heading">¶</a></h4>
<ul class="simple">
<li><p>added documentation effort</p>
<ul>
<li><p>But that is needed anyhow and some advice on how to use this feature is nice to have</p></li>
</ul>
</li>
<li><p>otherwise as option 2</p></li>
</ul>
</section>
</section>
</section>
<section id="decision">
<h2>Decision<a class="headerlink" href="#decision" title="Link to this heading">¶</a></h2>
<p>Option 3 is taken.</p>
</section>
</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../../index.html">
              <img class="logo" src="../../_static/crinit-logo.png" alt="Logo"/>
            </a></p>
<h1 class="logo"><a href="../../index.html">crinit</a></h1>








<h3>Navigation</h3>
<p class="caption" role="heading"><span class="caption-text">Contents</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../README.html">Crinit – Configurable Rootfs Init</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../README.html#license">License</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../README.html#details">Details</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../API-Doc.html">Public API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../src/index.html">Developers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../scripts/README.html">Crinit-related scripts</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../scripts/README.html#script-usage-information">Script usage information</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../scripts/README.html#usage-examples">Usage examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../scripts/README.html#note-on-the-key-type-used-in-crinit-genkeys-sh">Note on the key type used in <code class="docutils literal notranslate"><span class="pre">crinit-genkeys.sh</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="../../test/README.html">Tests</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">ADRS</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="index.html#list-of-adrs">List of ADRs</a></li>
</ul>
</li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../../index.html">Documentation overview</a><ul>
  <li><a href="index.html">Architecture Design Records</a><ul>
      <li>Previous: <a href="adr-signature-storage.html" title="previous chapter">Architecture Design Record - Storage scheme for file signatures</a></li>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2023, emlix GmbH/Elektrobit Automotive GmbH.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 7.2.6</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.13</a>
      
      |
      <a href="../../_sources/doc/adr/adr-task-include-strategy.md.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>
<!DOCTYPE html>

<html lang="en" data-content_root="../../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />
    <link href="../../_static/favicon_16x16.png" sizes="16x16" rel="icon" type="image/png">
    <link href="../../_static/favicon_32x32.png" sizes="32x32" rel="icon" type="image/png">
    <title>Architecture Design Record - Management of named pipes for IO redirection &#8212; crinit  documentation</title>
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=4f649999" />
    <link rel="stylesheet" type="text/css" href="../../_static/alabaster.css?v=039e1c02" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css?v=76b2166b" />
    <script src="../../_static/documentation_options.js?v=5929fcd5"></script>
    <script src="../../_static/doctools.js?v=888ff710"></script>
    <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../../_static/copybutton.js?v=f281be69"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Architecture Design Record - Storage scheme for public keys" href="adr-pubkey-storage.html" />
    <link rel="prev" title="Architecture Design Record - Choice of cryptographic library for config signatures" href="adr-crypt-lib.html" />
   
  <link rel="stylesheet" href="../../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="architecture-design-record-management-of-named-pipes-for-io-redirection">
<h1>Architecture Design Record - Management of named pipes for IO redirection<a class="headerlink" href="#architecture-design-record-management-of-named-pipes-for-io-redirection" title="Link to this heading">¶</a></h1>
<section id="problem">
<h2>Problem<a class="headerlink" href="#problem" title="Link to this heading">¶</a></h2>
<p>As of version <code class="docutils literal notranslate"><span class="pre">0.9.0</span></code>, crinit supports IO redirection from/to files. With <code class="docutils literal notranslate"><span class="pre">0.9.2</span></code>, this is extended to named pipes or
FIFOs using the <code class="docutils literal notranslate"><span class="pre">PIPE</span></code> keyword. The intention is to simplify connecting <code class="docutils literal notranslate"><span class="pre">STDOUT/ERR</span></code> from one task to <code class="docutils literal notranslate"><span class="pre">STDIN</span></code> of
another. Prior to the addition, the user would have to create the special file tied to the named pipe themselves using mkfifo.</p>
<p>For the new functionality, crinit will handle creation of the named pipe (aka. fifo) itself. The remaining question is, if crinit should
somehow manage that special file during its lifetime or if one-time creation is enough.</p>
</section>
<section id="influencing-factors">
<h2>Influencing Factors<a class="headerlink" href="#influencing-factors" title="Link to this heading">¶</a></h2>
<section id="assumptions">
<h3>Assumptions<a class="headerlink" href="#assumptions" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p>presence of a writable temporary file system like <code class="docutils literal notranslate"><span class="pre">/tmp</span></code> or <code class="docutils literal notranslate"><span class="pre">/run</span></code></p></li>
</ul>
</section>
</section>
<section id="considered-alternatives">
<h2>Considered Alternatives<a class="headerlink" href="#considered-alternatives" title="Link to this heading">¶</a></h2>
<section id="option-1-named-pipe-aka-fifo-creation-only">
<h3>Option 1 - Named Pipe (aka FIFO) creation only<a class="headerlink" href="#option-1-named-pipe-aka-fifo-creation-only" title="Link to this heading">¶</a></h3>
<p>The IO redirection statement shall be of the form</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">IO_REDIRECT</span> <span class="o">=</span> <span class="o">&lt;</span><span class="n">STREAM</span><span class="o">&gt;</span> <span class="s2">&quot;/path/to/pipe&quot;</span> <span class="n">PIPE</span> <span class="p">[</span><span class="n">OCTAL_MODE</span><span class="p">]</span>
</pre></div>
</div>
<p>The pipe’s path is to be decided entirely by configuration. In order for two tasks to be connected they need to point
to the same path. If a task finds no existing named pipe at the target, it will create one. The created named pipe will stay there
until externally deleted.</p>
<section id="pros">
<h4>Pros<a class="headerlink" href="#pros" title="Link to this heading">¶</a></h4>
<ul class="simple">
<li><p>simple concept</p></li>
<li><p>least implementation effort required</p></li>
<li><p>no assumptions of target system structure necessary</p></li>
<li><p>named pipe is easily externally accessible</p>
<ul>
<li><p>in case we want to send something to a Crinit task from a process not managed by Crinit</p></li>
</ul>
</li>
</ul>
</section>
<section id="cons">
<h4>Cons<a class="headerlink" href="#cons" title="Link to this heading">¶</a></h4>
<ul class="simple">
<li><p>no centralized location where all named pipes reside</p></li>
<li><p>no deletion of named pipe files after use suggests a temporary file system</p>
<ul>
<li><p>But: that is the usual way to do it anyway</p></li>
</ul>
</li>
<li><p>some organisation work offloaded to system integrator</p></li>
</ul>
</section>
</section>
<section id="option-2-pipe-file-management">
<h3>Option 2 - Pipe file management<a class="headerlink" href="#option-2-pipe-file-management" title="Link to this heading">¶</a></h3>
<p>Crinit maintains a list of named pipes residing in a central (globally configurable) location. Tasks use named
references, defaulting to their own name.</p>
<p>For a sender and a receiver that may look like</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># sending task</span>
<span class="n">NAME</span> <span class="o">=</span> <span class="n">sender_task</span>
<span class="p">[</span><span class="o">...</span><span class="p">]</span>
<span class="n">IO_REDIRECT</span> <span class="o">=</span> <span class="n">STDOUT</span> <span class="n">PIPE</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># receiving task</span>
<span class="n">NAME</span> <span class="o">=</span> <span class="n">receiver_task</span>
<span class="p">[</span><span class="o">...</span><span class="p">]</span>
<span class="n">IO_REDIRECT</span> <span class="o">=</span> <span class="n">STDIN</span> <span class="n">sender_task</span> <span class="n">PIPE</span>
</pre></div>
</div>
<p>Upon first encountering the <code class="docutils literal notranslate"><span class="pre">sender_task</span></code> pipe reference, crinit will create that named pipe in the globally configured
FIFODIR (default would be something like <code class="docutils literal notranslate"><span class="pre">/run/crinit/fifos/</span></code>). Optionally crinit might clear that directory on
shutdown, or even if all connected tasks terminate if so configured.</p>
<section id="id1">
<h4>Pros<a class="headerlink" href="#id1" title="Link to this heading">¶</a></h4>
<ul class="simple">
<li><p>better managed centralized location</p></li>
<li><p>crinit takes off some organisation work from system integrator</p></li>
<li><p>optional deletion possible</p></li>
</ul>
</section>
<section id="id2">
<h4>Cons<a class="headerlink" href="#id2" title="Link to this heading">¶</a></h4>
<ul class="simple">
<li><p>concept more complex</p></li>
<li><p>implementation work more complex</p></li>
<li><p>named pipe is not easily accessible from outside</p></li>
</ul>
</section>
</section>
<section id="option-3-both-usable-decided-through-configuration">
<h3>Option 3 - Both usable, decided through configuration<a class="headerlink" href="#option-3-both-usable-decided-through-configuration" title="Link to this heading">¶</a></h3>
<p>For this, we can let Crinit behave as in option 1 if given an absolute path or as in option 2 otherwise.</p>
<section id="id3">
<h4>Pros<a class="headerlink" href="#id3" title="Link to this heading">¶</a></h4>
<ul class="simple">
<li><p>pros of options 1 and 2 excluding complexity considerations</p></li>
</ul>
</section>
<section id="id4">
<h4>Cons<a class="headerlink" href="#id4" title="Link to this heading">¶</a></h4>
<ul class="simple">
<li><p>most complex concept</p></li>
<li><p>most complex implementations</p></li>
<li><p>less intuitive for users</p></li>
</ul>
</section>
</section>
<section id="option-4-anonymous-classic-pipes">
<h3>Option 4 - Anonymous ‘classic’ pipes<a class="headerlink" href="#option-4-anonymous-classic-pipes" title="Link to this heading">¶</a></h3>
<p>This approach is similar to Option 2, it connects IOs by the same naming schema, but it uses classic pipes ( <code class="docutils literal notranslate"><span class="pre">man</span> <span class="pre">2</span> <span class="pre">pipe</span></code> ) for that. Crinit will centrally manage opened pipe file descriptors in memory.</p>
<section id="id5">
<h4>Pros<a class="headerlink" href="#id5" title="Link to this heading">¶</a></h4>
<ul class="simple">
<li><p>simpler handling, especially clean up</p></li>
<li><p>analoguous to shell pipes</p></li>
<li><p>pipe can be opened while task are waiting to be startable</p>
<ul>
<li><p>potential to improve speed of process spawning</p></li>
</ul>
</li>
</ul>
</section>
<section id="id6">
<h4>Cons<a class="headerlink" href="#id6" title="Link to this heading">¶</a></h4>
<ul class="simple">
<li><p>no way to access the pipe externally, hence option 1 is needed additionally.</p></li>
<li><p>implementation work simlarly complex to option 2</p></li>
</ul>
</section>
</section>
</section>
<section id="decision">
<h2>Decision<a class="headerlink" href="#decision" title="Link to this heading">¶</a></h2>
<p>Option 1 is taken for current milestone <code class="docutils literal notranslate"><span class="pre">0.9.2</span></code>, with possibility to add option 4 for later releases.</p>
</section>
<section id="rationale">
<h2>Rationale<a class="headerlink" href="#rationale" title="Link to this heading">¶</a></h2>
<p>Options 4 and 1 share technical groundwork in the low-level process spawning area. While option 1 does not need much
more than that, option 4 needs more higher level logic within crinit. Given that, option 1 can be seen as a reasonable
stepping stone to offer basic functionality now, evaluate feedback, and extend towards option 4 down the line if
required.</p>
</section>
</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../../index.html">
              <img class="logo" src="../../_static/crinit-logo.png" alt="Logo"/>
            </a></p>
<h1 class="logo"><a href="../../index.html">crinit</a></h1>








<h3>Navigation</h3>
<p class="caption" role="heading"><span class="caption-text">Contents</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../README.html">Crinit – Configurable Rootfs Init</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../README.html#license">License</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../README.html#details">Details</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../API-Doc.html">Public API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../src/index.html">Developers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../scripts/README.html">Crinit-related scripts</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../scripts/README.html#script-usage-information">Script usage information</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../scripts/README.html#usage-examples">Usage examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../scripts/README.html#note-on-the-key-type-used-in-crinit-genkeys-sh">Note on the key type used in <code class="docutils literal notranslate"><span class="pre">crinit-genkeys.sh</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="../../test/README.html">Tests</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">ADRS</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="index.html#list-of-adrs">List of ADRs</a></li>
</ul>
</li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../../index.html">Documentation overview</a><ul>
  <li><a href="index.html">Architecture Design Records</a><ul>
      <li>Previous: <a href="adr-crypt-lib.html" title="previous chapter">Architecture Design Record - Choice of cryptographic library for config signatures</a></li>
      <li>Next: <a href="adr-pubkey-storage.html" title="next chapter">Architecture Design Record - Storage scheme for public keys</a></li>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2023, emlix GmbH/Elektrobit Automotive GmbH.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 7.2.6</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.13</a>
      
      |
      <a href="../../_sources/doc/adr/adr-pipe-redirection.md.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>